<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>[자바 ORM 표준 JPA 프로그래밍] 12장_스프링 데이터 JPA - Always Learning</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Always Learning"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Always Learning"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="데이터 접근 계층 (Data Access Layer) 는 CRUD 로 불리는 등록, 수정, 삭제, 조회 코드를 반복해서 개발해야 한다.JPA 를 사용해서 데이터 접근 계층을 개발할 때도 문제가 발생한다. 123456789101112131415161718192021public class MemberRepository&amp;amp;#123;    @PersistenceCo"><meta property="og:type" content="blog"><meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍] 12장_스프링 데이터 JPA"><meta property="og:url" content="https://junhee-ko.github.io/2019/04/21/spring-data-jpa/"><meta property="og:site_name" content="Always Learning"><meta property="og:description" content="데이터 접근 계층 (Data Access Layer) 는 CRUD 로 불리는 등록, 수정, 삭제, 조회 코드를 반복해서 개발해야 한다.JPA 를 사용해서 데이터 접근 계층을 개발할 때도 문제가 발생한다. 123456789101112131415161718192021public class MemberRepository&amp;amp;#123;    @PersistenceCo"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://junhee-ko.github.io/image/spring-data-jpa.png"><meta property="og:image" content="https://junhee-ko.github.io/image/spring-data-jpa-repository.png"><meta property="og:image" content="https://junhee-ko.github.io/image/spring-data-jpa-paging-and-sorting-repository.png"><meta property="og:image" content="https://junhee-ko.github.io/image/spring-data-jpa-crud-repository.png"><meta property="og:image" content="https://junhee-ko.github.io/image/spring-data-jpa-parent-repository.png"><meta property="og:image" content="https://junhee-ko.github.io/image/spring-data-jpa-inheritance.png"><meta property="og:image" content="https://junhee-ko.github.io/image/spring-data-simpe-jpa-repository.png"><meta property="article:published_time" content="2019-04-20T15:00:00.000Z"><meta property="article:modified_time" content="2021-07-17T07:08:50.818Z"><meta property="article:author" content="junhee.ko"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/image/spring-data-jpa.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://junhee-ko.github.io/2019/04/21/spring-data-jpa/"},"headline":"[자바 ORM 표준 JPA 프로그래밍] 12장_스프링 데이터 JPA","image":["https://junhee-ko.github.io/image/spring-data-jpa.png","https://junhee-ko.github.io/image/spring-data-jpa-repository.png","https://junhee-ko.github.io/image/spring-data-jpa-paging-and-sorting-repository.png","https://junhee-ko.github.io/image/spring-data-jpa-crud-repository.png","https://junhee-ko.github.io/image/spring-data-jpa-parent-repository.png","https://junhee-ko.github.io/image/spring-data-jpa-inheritance.png","https://junhee-ko.github.io/image/spring-data-simpe-jpa-repository.png"],"datePublished":"2019-04-20T15:00:00.000Z","dateModified":"2021-07-17T07:08:50.818Z","author":{"@type":"Person","name":"junhee.ko"},"publisher":{"@type":"Organization","name":"Always Learning","logo":{"@type":"ImageObject","url":"https://junhee-ko.github.io/img/logo.svg"}},"description":"데이터 접근 계층 (Data Access Layer) 는 CRUD 로 불리는 등록, 수정, 삭제, 조회 코드를 반복해서 개발해야 한다.JPA 를 사용해서 데이터 접근 계층을 개발할 때도 문제가 발생한다. 123456789101112131415161718192021public class MemberRepository&amp;#123;    @PersistenceCo"}</script><link rel="canonical" href="https://junhee-ko.github.io/2019/04/21/spring-data-jpa/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Always Learning" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-04-20T15:00:00.000Z" title="4/21/2019, 12:00:00 AM">2019-04-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-17T07:08:50.818Z" title="7/17/2021, 4:08:50 PM">2021-07-17</time></span><span class="level-item"><a class="link-muted" href="/categories/jpa/">JPA</a></span></div></div><h1 class="title is-3 is-size-4-mobile">[자바 ORM 표준 JPA 프로그래밍] 12장_스프링 데이터 JPA</h1><div class="content"><p>데이터 접근 계층 (Data Access Layer) 는 CRUD 로 불리는 등록, 수정, 삭제, 조회 코드를 반복해서 개발해야 한다.<br>JPA 를 사용해서 데이터 접근 계층을 개발할 때도 문제가 발생한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberRepository</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PersistenceContext</span></span><br><span class="line">  EntityManager em;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Member member)</span> </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Member <span class="title">findOne</span><span class="params">(Long id)</span> </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;Member&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> Member <span class="title">findByUsername</span><span class="params">(String username)</span> </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemRepository</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PersistenceContext</span></span><br><span class="line">  EntityManager em;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Item item)</span> </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Member <span class="title">findOne</span><span class="params">(Long id)</span> </span>&#123;...&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;Member&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위 코드를 보면, 회원 리포지토리와 상품 리포지토리가 하는 일이 비슷하다.<br>이 문제를 해결하려면 제네릭과 상속을 적절히 사용해서 공통 부분을 처리하는 부모 클래스를 만들면 된다. 이것을 보통 GenericDAO 라고 한다.<br>하지만 이것은, 공통 기능을 구현하는 부모 클래스에 종속되고 구현 클래스 상속이 가지는 단점이 있다. </p>
<h2 id="스프링-데이터-JPA"><a href="#스프링-데이터-JPA" class="headerlink" title="스프링 데이터 JPA"></a>스프링 데이터 JPA</h2><p>스프링 데이터 JPA 는 스프링 프레임워크에서 JPA 를 편리하게 사용할수 있도록 지원하는 프로젝트이다.<br>이 프로젝트는 데이터 접근 계층을 개발할 때 지루하게 반복되는 CRUD 문제를 세련된 방법으로 해결한다.<br>데이터 접근 계층을 개발할 때 구현 클래스 없이 인터페이스만 작성해도 개발을 완료할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Member</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function">Member <span class="title">findByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ItemRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Item</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>회원과 상품 리포지토리 구현체는 애플리케이션 실행 시점에 스프링 데이터 JPA 가 생성해서 주입해준다. 즉, 개발자가 직접 구현체를 개발하지 않아도 된다.<br>일반적인 CRUD 메소드는 JpaRepository 인터페이스가 공통으로 제공하지만,<br>MemberRepository.findByUsername(…) 처럼 직접 작성한 공통으로 처리할 수 없는 메소드는 스프링 데이터 JPA 가 메소드 이름을 분석해서 JPQL 을 실행한다.</p>
<h2 id="스프링-데이터-프로젝트"><a href="#스프링-데이터-프로젝트" class="headerlink" title="스프링 데이터 프로젝트"></a>스프링 데이터 프로젝트</h2><p>스프링 데이터 JPA 프로젝트는 JPA 에 특화된 기능을 제공한다.</p>
<p><img src="/image/spring-data-jpa.png"></p>
<h2 id="JpaRepository-계층-구조"><a href="#JpaRepository-계층-구조" class="headerlink" title="JpaRepository 계층 구조"></a>JpaRepository 계층 구조</h2><p>JpaRepository interface의 계층 구조를 직접 확인해보자.</p>
<p>JpaRepository 는 org.springframework.data.jpa.repository 에 속해있다.<br>JpaRepository 는 다시 PagingAndSortingRepository 를 상속하고 있다.</p>
<p><img src="/image/spring-data-jpa-repository.png"></p>
<p>PagingAndSortingRepository interface 의 package 는 org.springframework.data.jpa.repository 가 아니라, org.springframework.data.repository 이다.<br>PagingAndSortingRepository 는 다시 CrudRepository 를 상속한다.</p>
<p><img src="/image/spring-data-jpa-paging-and-sorting-repository.png"></p>
<p>CrudRepository interface 의 package 는 org.springframework.data.jpa.repository 가 아니라, org.springframework.data.repository 이다.<br>CrudRepository 는 다시 Repository 를 상속한다.</p>
<p><img src="/image/spring-data-jpa-crud-repository.png"></p>
<p>Repository interface 의 package 는 org.springframework.data.jpa.repository 가 아니라, org.springframework.data.repository 이다.</p>
<p><img src="/image/spring-data-jpa-parent-repository.png"></p>
<p>정리하면 다음 계층구조이다.</p>
<p><img src="/image/spring-data-jpa-inheritance.png"></p>
<h2 id="스프링-데이터-JPA-가-사용하는-구현체"><a href="#스프링-데이터-JPA-가-사용하는-구현체" class="headerlink" title="스프링 데이터 JPA 가 사용하는 구현체"></a>스프링 데이터 JPA 가 사용하는 구현체</h2><p>스프링 데이터 JPA 가 제공하는 공통 인터페이스는 org.springframework.data.jpa.repository.support.SimpleJpaRepository 클래스가 구현한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleJpaRepository</span>&lt;<span class="title">T</span>, <span class="title">ID</span> <span class="keyword">extends</span> <span class="title">Serializable</span>&gt; <span class="keyword">implements</span> <span class="title">JpaRepository</span>&lt;<span class="title">T</span>, <span class="title">ID</span>&gt;, <span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>직접 확인해보자.</p>
<p>의존성을 다음과 같이 추가한다.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-data-jpa&#x27;</span></span><br><span class="line">    testImplementation <span class="string">&#x27;com.h2database:h2&#x27;</span></span><br><span class="line">    testImplementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-test&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>그리고 Repository 를 정의한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TestRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Test</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TestRepository 룰 출력해보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoSpringDataJpaApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> TestRepository testRepository;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(testRepository);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>결과는, SimpleJpaRepository 클래스 명이 출력된다.<br>repository interface 를 정의했을 뿐인데, 구체 클래스가 주입이 되었다.</p>
<p><img src="/image/spring-data-simpe-jpa-repository.png"></p>
<h2 id="Query-Method"><a href="#Query-Method" class="headerlink" title="Query Method"></a>Query Method</h2><p>스프링 데이터 JPA 가 제공하는 쿼리 메소드 기능은 크게 세 가지이다.</p>
<ol>
<li>메소드 이름으로 쿼리 생성</li>
<li>메소드 이름으로 JPA NamedQuery 호출</li>
<li>@Query 어노테이션을 사용해서 리포지토리 인터페이스에 쿼리 직접 정의</li>
</ol>
<h3 id="메소드-이름으로-쿼리-생성"><a href="#메소드-이름으로-쿼리-생성" class="headerlink" title="메소드 이름으로 쿼리 생성"></a>메소드 이름으로 쿼리 생성</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberRepository</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">Member</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function">List&lt;Member&gt; <span class="title">findByEmailAndName</span> <span class="params">(String email, String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>findByEmailAndName(…) 를 실행하면 스프링 데이터 JPA 는 메소드 이름을 분석해서 다음 JPQL 을 생성하고 실행한다.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> m <span class="keyword">from</span> <span class="keyword">Member</span> m <span class="keyword">where</span> m.email <span class="operator">=</span> ?<span class="number">1</span> <span class="keyword">and</span> m.name <span class="operator">=</span>?<span class="number">2</span></span><br></pre></td></tr></table></figure>

<h3 id="JPA-NamedQuery"><a href="#JPA-NamedQuery" class="headerlink" title="JPA NamedQuery"></a>JPA NamedQuery</h3><p>스프링 데이터 JPA 는 메소드 이름으로 JPA Named 쿼리를 호출하는 기능을 제공합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@NamedQuery</span>&#123;</span><br><span class="line">  name = <span class="string">&quot;Member.findByUsername&quot;</span>,</span><br><span class="line">  query = <span class="string">&quot;select m from Member m where m.username = :username&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이렇게 정의한 Named 쿼리를 다음과 같이 호출한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JPA를 직접 사용해서 Named Query 호출</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberRepository</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;Member&gt; <span class="title">findByUserName</span><span class="params">(String username)</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    List&lt;Member&gt; resultList =</span><br><span class="line">      	em.createNaemdQuery(<span class="string">&quot;Member.findByUsername&quot;</span>, Member.class)</span><br><span class="line">      	  .setParameter(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;회원1&quot;</span>)</span><br><span class="line">          .getResultList();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 스프링 데이터 JPA 로 호출</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span> &lt;<span class="title">Member</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">  List &lt;Member&gt; findByUserName(<span class="meta">@Param(&quot;username&quot;)</span> String username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>스프링 데이터 JPA 로 호출하는 경우, “도메인 클래스.메소드이름” 으로 Named Query 를 찾아서 실행한다.<br>위 예제는, Member.findByUsername 이라는 Named Query 를 실행한다.<br>만약, Named Query 가 없으면 메소드 이름으로 쿼리 생성 전략을 사용한다.</p>
<h3 id="Query-리포지토리-메소드에-쿼리-정의"><a href="#Query-리포지토리-메소드에-쿼리-정의" class="headerlink" title="@Query, 리포지토리 메소드에 쿼리 정의"></a>@Query, 리포지토리 메소드에 쿼리 정의</h3><p>실행할 메소드에 직접 정적 쿼리를 작성하므로, 이름 없는 Named Query 라고 할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Member</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@Query(&quot;select m from Member m where m.username = ?1&quot;)</span></span><br><span class="line">  <span class="function">Member <span class="title">findByUserName</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="파라미터-바인딩"><a href="#파라미터-바인딩" class="headerlink" title="파라미터 바인딩"></a>파라미터 바인딩</h2><p>스프링 데이터 JPA 는 위치 기반 파라미터 바인딩과 이름 기반 파라미터 바인딩을 모두 지원한다.<br>다음은 이름 기반 파라미터 바인딩 예제이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Member</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@Query(&quot;select m from Member m where m.username = :name&quot;)</span></span><br><span class="line">  <span class="function">Member <span class="title">findByUserName</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="벌크성-수정-쿼리"><a href="#벌크성-수정-쿼리" class="headerlink" title="벌크성 수정 쿼리"></a>벌크성 수정 쿼리</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JPA 를 사용한 벌크성 수정 쿼리</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bulkPriceUp</span><span class="params">(String stockAmout)</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  String sqlString = <span class="string">&quot;update Product p set p.price = p.price * 1.1 where p.stockAmout &lt; :stockAmout&quot;</span>;</span><br><span class="line">      </span><br><span class="line">  <span class="keyword">int</span> resultCount = em.createQuery(sqlString)</span><br><span class="line">        .setParameter(<span class="string">&quot;stockAmout&quot;</span>, stockAmout)</span><br><span class="line">        .executeUpdate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 스프링 데이터 JPA 를 사용한 벌크성 수정 쿼리</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Query(&quot;update Product p set p.price = p.price * 1.1 where p.stockAmout &lt; :stockAmout&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bulkPriceUp</span><span class="params">(<span class="meta">@Param(&quot;stockAmout&quot;)</span> String stockAmout)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="반환-타입"><a href="#반환-타입" class="headerlink" title="반환 타입"></a>반환 타입</h2><p>결과가 한건 이상이면 컬렉션 인터페이스, 단건이면 반환 타입을 지정한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Member&gt; <span class="title">findByName</span> <span class="params">(String name)</span></span>; <span class="comment">// 컬렉션</span></span><br><span class="line"><span class="function">Member <span class="title">findByEmail</span> <span class="params">(String email)</span></span>; <span class="comment">// 단건</span></span><br></pre></td></tr></table></figure>

<h2 id="페이징과-정렬"><a href="#페이징과-정렬" class="headerlink" title="페이징과 정렬"></a>페이징과 정렬</h2><p>쿼리 메소드에 페이징과 정렬 기능을 사용할 수 있도록 두 가지 파라미터를 제공한다.</p>
<ol>
<li>org.springframework.data.domain.sort</li>
<li>org.springframework.data.domain.Pageable</li>
</ol>
<p>파라미터에 Pageable 을 사용하면, 반환타입으로 List 나 org.springframework.data.domain.Page 를 사용할 수 있다.<br>반환 타입으로 Page 를 사용하면 검색된 전체 데이터 건수를 조회하는 count 쿼리를 추가로 호출할 수 있다.</p>
<p>Pageable 은 인터페이스이다.<br>실제 사용할 때는 이를 구현한 PageRequest 객체를 사용한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 페이징과 정렬 사용 예제</span></span><br><span class="line"><span class="function">Page&lt;Member&gt; <span class="title">findByName</span><span class="params">(String name, Pageable pageable)</span></span>;</span><br><span class="line"><span class="function">List&lt;Member&gt; <span class="title">findByName</span><span class="params">(String name, Pageable pageable)</span></span>;</span><br><span class="line"><span class="function">List&lt;Member&gt; <span class="title">findByName</span><span class="params">(String name, Sort sort)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Page 사용 예제 정의 코드</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberRepository</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">Member</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function">Page&lt;Member&gt; <span class="title">findByNameStartingWith</span><span class="params">(String name, Pageable pageable)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Page 사용 예제 실행 코드</span></span><br><span class="line">PageRequest pageRequest = <span class="keyword">new</span> PageRequest(<span class="number">0</span>, <span class="number">10</span>, <span class="keyword">new</span> Sort(Direction.DESC, <span class="string">&quot;name&quot;</span>));</span><br><span class="line">Page&lt;Member&gt; result = memberRepository.findByNameStartingWith(<span class="string">&quot;김&quot;</span>, pageRequest);</span><br><span class="line"></span><br><span class="line">List&lt;Member&gt; members = result.getContent();</span><br><span class="line"><span class="keyword">int</span> totalPage = result.getTotalPages();</span><br><span class="line"><span class="keyword">boolean</span> hasNextPage = result.hasNextPage();</span><br></pre></td></tr></table></figure>

<h2 id="Web-확장"><a href="#Web-확장" class="headerlink" title="Web 확장"></a>Web 확장</h2><p>스프링 데이터 프로젝트는 스프링 MVC 에서 사용할 수 있는 기능을 제공한다.</p>
<ol>
<li>도메인 클래스 컨버터 : HTTP 파라미터로 넘어온 엔티티의 아이디로 엔티티 객체를 찾아서 바인딩해준다.</li>
<li>페이징과 정렬 기능</li>
</ol>
<p>다음과 같이 설졍하면, 도메인 클래스 컨버터와 페이징과 정렬을 위한 HandlerMethodArgumentResolver 가 스프링 빈으로 등록된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@EnableSpringDataWebSupport</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebAppConfig</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>자바 ORM 표준 프로그래밍 &lt;김영한&gt;</p>
</div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/06/12/web-application-persistencen-context/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">[자바 ORM 표준 JPA 프로그래밍] 13장_웹 어플리케이션과 영속성 관리</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/04/09/jpa-proxy/"><span class="level-item">[자바 ORM 표준 JPA 프로그래밍] 8장_프록시와 연관관계 정리</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://junhee-ko.github.io/2019/04/21/spring-data-jpa/';
            this.page.identifier = '2019/04/21/spring-data-jpa/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'junhee-ko' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><p class="title is-size-4 is-block" style="line-height:inherit;">Junhee Ko</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">330</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">18</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/junhee-ko" target="_blank" rel="noopener">Follow</a></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-03-19T15:00:00.000Z">2022-03-20</time></p><p class="title"><a href="/2022/03/20/effective-kotlin-safety/">Effective Kotlin - Safety</a></p><p class="categories"><a href="/categories/kotlin/">Kotlin</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-26T15:00:00.000Z">2022-02-27</time></p><p class="title"><a href="/2022/02/27/spring-kakfa-test/">Spring Kafka Test</a></p><p class="categories"><a href="/categories/kafka/">Kafka</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-16T15:00:00.000Z">2022-02-17</time></p><p class="title"><a href="/2022/02/17/spring-data-jpa-paging/">Spring Data JPA Paging</a></p><p class="categories"><a href="/categories/jpa/">JPA</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-12T15:00:00.000Z">2022-02-13</time></p><p class="title"><a href="/2022/02/13/kotlin-compiler-plugins/">Kotlin Compiler Plugins</a></p><p class="categories"><a href="/categories/kotlin/">Kotlin</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-22T15:00:00.000Z">2022-01-23</time></p><p class="title"><a href="/2022/01/23/kotlin-generics/">Generics</a></p><p class="categories"><a href="/categories/kotlin/">Kotlin</a></p></div></article></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">180</span></span></a></li><li><a class="level is-mobile" href="/categories/big-data/"><span class="level-start"><span class="level-item">Big Data</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/container/"><span class="level-start"><span class="level-item">Container</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/git/"><span class="level-start"><span class="level-item">Git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/graphql/"><span class="level-start"><span class="level-item">GraphQL</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/jpa/"><span class="level-start"><span class="level-item">JPA</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/kafka/"><span class="level-start"><span class="level-item">Kafka</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/kotlin/"><span class="level-start"><span class="level-item">Kotlin</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/oauth/"><span class="level-start"><span class="level-item">OAuth</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/oop/"><span class="level-start"><span class="level-item">OOP</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/os/"><span class="level-start"><span class="level-item">OS</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/reactor/"><span class="level-start"><span class="level-item">Reactor</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/redis/"><span class="level-start"><span class="level-item">Redis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/tdd/"><span class="level-start"><span class="level-item">TDD</span></span><span class="level-end"><span class="level-item tag">32</span></span></a></li><li><a class="level is-mobile" href="/categories/test-code/"><span class="level-start"><span class="level-item">Test Code</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/grpc/"><span class="level-start"><span class="level-item">gRPC</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Always Learning" height="28"></a><p class="is-size-7"><span>&copy; 2022 junhee.ko</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>